---
- name: Add the OS specific varibles
  include_vars: "{{ ansible_os_family }}.yml"

- name: Add /etc/hosts entry for ldap server
  lineinfile:
    dest: /etc/hosts
    state: present
    line: "{{ openldap_server_ip }} {{ openldap_server_domain_name }} {{ openldap_server_domain_name.split('.')[0] }}"

- name: "Uninstall any Python requirements currently installed via OS package manager"
  package:
    name: "{{ common_uninstall_pkgs }}"
    state: absent
  when: common_uninstall_pkgs is defined

- name: "Install all Python2 requirements via Pip"
  pip:
    name: "{{ common_python_pkgs }}"
    state: latest
    executable: pip2
  when: common_python_pkgs is defined

- name: "Install all Python3 requirements via Pip"
  pip:
    name: "{{ common_python3_pkgs }}"
    state: latest
    executable: pip3
  when: common_python3_pkgs is defined

- import_tasks: ldap_server.yml
  when: "'ldapservers' in group_names"

- import_tasks: configure_ldap.yml
  when: "'ldapservers' in group_names"

- name: "Configure LDAP Client [Debian]"
  import_tasks: ldap_client_debian.yml
  when: ansible_os_family == "Debian"

- name: "Configure LDAP Client [RedHat]"
  import_tasks: ldap_client_redhat.yml
  when: ansible_os_family == "RedHat"

- import_tasks: ldap_automount.yml
  when:
    - "'ldapservers' in group_names"
    - shared_storage

- import_tasks: ldap_users.yml
  when:
    - "'ldapservers' in group_names"

- import_tasks: smbd_server.yml
  when:
    - "'samba' in group_names"

- import_tasks: configure_smb.yml
  when:
    - "'samba' in group_names"

- import_tasks: afpd.yml
  when:
    - "'afpd' in group_names"
